% Diary of Snakes and Ladders game viewed as a Markov process.
A = [ 1/4 1/4 1/4 0 1/4 0 0 ;
0 1/4 1/2 0 1/4 0 0 ; 
0 0 1/4 1/4 1/4 1/4 0 ;
1/4 0 0 1/4 1/4 1/4 0 ;
1/4 0 0 0 1/4 1/4 1/4 ;
1/4 0 0 0 1/4 1/4 1/4 ;
1/4 0 0 0 0 1/2 1/4 ]

A =

    0.2500    0.2500    0.2500         0    0.2500         0         0
         0    0.2500    0.5000         0    0.2500         0         0
         0         0    0.2500    0.2500    0.2500    0.2500         0
    0.2500         0         0    0.2500    0.2500    0.2500         0
    0.2500         0         0         0    0.2500    0.2500    0.2500
    0.2500         0         0         0    0.2500    0.2500    0.2500
    0.2500         0         0         0         0    0.5000    0.2500

size(A)

ans =

     7     7

A = [ zeros(7,1) A ]

A =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.5000    0.2500

A = [ A ; zeros(1,8) ]

A =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.5000    0.2500
         0         0         0         0         0         0         0         0

A(8,8) = 1

A =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.5000    0.2500
         0         0         0         0         0         0         0    1.0000

diary off
% Now to compute the stopping times.
% Set up the matrix corresponding to all states without W.
B = A(1:7,1:7) , v = ones(7,1) , Id = diag(ones(7,1))

B =

         0    0.2500    0.2500    0.2500         0    0.2500         0
         0         0    0.2500    0.5000         0    0.2500         0
         0         0         0    0.2500    0.2500    0.2500    0.2500
         0    0.2500         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0    0.2500    0.2500
         0    0.2500         0         0         0    0.2500    0.2500
         0    0.2500         0         0         0         0    0.5000


v =

     1
     1
     1
     1
     1
     1
     1


Id =

     1     0     0     0     0     0     0
     0     1     0     0     0     0     0
     0     0     1     0     0     0     0
     0     0     0     1     0     0     0
     0     0     0     0     1     0     0
     0     0     0     0     0     1     0
     0     0     0     0     0     0     1

% Now to compute the stopping times.
tau = inv(Id-B)*v

tau =

    8.3636
    8.2182
    7.4909
    7.6364
    6.1091
    6.1091
    6.1091

diary off
% Now we introduce an extra state L.
A

A =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.5000    0.2500
         0         0         0         0         0         0         0         0

save S_n_L
B = [ A zeros(8,1) ]

B =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0         0    0.5000    0.2500         0
         0         0         0         0         0         0         0         0         0

B = [ B ; zeros(1,9) ]

B =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0         0    0.5000    0.2500         0
         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0

% Now we need to fix various elements of B.
B(6,1) = 0 , B(6,9) = 1/4

B =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0         0    0.5000    0.2500         0
         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0


B =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.5000    0.2500         0
         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0

B(7,7) = 1/4 , B(7,9) = 1/4

B =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.2500    0.2500         0
         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0


B =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.2500    0.2500    0.2500
         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0

B(8,8) = 1 , B(9,9) = 1

B =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.2500    0.2500    0.2500
         0         0         0         0         0         0         0    1.0000         0
         0         0         0         0         0         0         0         0         0


B =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.2500    0.2500    0.2500
         0         0         0         0         0         0         0    1.0000         0
         0         0         0         0         0         0         0         0    1.0000

% Try this and hope it works.
Id = diag(ones(7,1))

Id =

     1     0     0     0     0     0     0
     0     1     0     0     0     0     0
     0     0     1     0     0     0     0
     0     0     0     1     0     0     0
     0     0     0     0     1     0     0
     0     0     0     0     0     1     0
     0     0     0     0     0     0     1

C = B(1:7,1:7) , yW = B(1:7,8) , yL = B(1:7,9)

C =

         0    0.2500    0.2500    0.2500         0    0.2500         0
         0         0    0.2500    0.5000         0    0.2500         0
         0         0         0    0.2500    0.2500    0.2500    0.2500
         0    0.2500         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0    0.2500    0.2500
         0    0.2500         0         0         0    0.2500    0.2500
         0    0.2500         0         0         0         0    0.2500


yW =

         0
         0
         0
         0
    0.2500
    0.2500
    0.2500


yL =

         0
         0
         0
         0
         0
    0.2500
    0.2500

hW = inv(C)*yW , hL = inv(C)*yL
[Warning: Matrix is singular to working precision.] 

hW =

   NaN
   NaN
   NaN
   NaN
   NaN
   NaN
   NaN

[Warning: Matrix is singular to working precision.] 

hL =

   NaN
   NaN
   NaN
   NaN
   NaN
   NaN
   NaN

eig(C)

ans =

   0.0000 + 0.0000i
   0.8018 + 0.0000i
  -0.1509 + 0.3069i
  -0.1509 - 0.3069i
  -0.0000 + 0.0000i
   0.0000 + 0.0000i
  -0.0000 + 0.0000i

hW = inv(Id-C)*yW , hL = inv(Id-C)*yL

hW =

    0.7222
    0.7188
    0.7014
    0.7049
    0.7639
    0.7639
    0.5729


hL =

    0.6250
    0.6172
    0.5781
    0.5859
    0.4688
    0.7188
    0.5391


B*ones(9,1) - ones(9,1)

ans =

         0
         0
         0
         0
         0
    0.2500
         0
         0
         0

% Aha, that is the problem!
B

B =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.2500    0.2500    0.2500
         0         0         0         0         0         0         0    1.0000         0
         0         0         0         0         0         0         0         0    1.0000

B(6,6) = 0

B =

         0    0.2500    0.2500    0.2500         0    0.2500         0         0         0
         0         0    0.2500    0.5000         0    0.2500         0         0         0
         0         0         0    0.2500    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0    0.2500    0.2500    0.2500         0         0
         0    0.2500         0         0         0    0.2500    0.2500    0.2500         0
         0    0.2500         0         0         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0         0    0.2500    0.2500    0.2500
         0         0         0         0         0         0         0    1.0000         0
         0         0         0         0         0         0         0         0    1.0000

B*ones(9,1) - ones(9,1)

ans =

     0
     0
     0
     0
     0
     0
     0
     0
     0

C = B(1:7.1:7) , yW = B(1:7,8) , YL = B(1:7,9)
[Warning: Integer operands are required for colon operator when used as index.] 

C =

     0


yW =

         0
         0
         0
         0
    0.2500
    0.2500
    0.2500


YL =

         0
         0
         0
         0
         0
    0.2500
    0.2500

C = B(1:7,1:7)

C =

         0    0.2500    0.2500    0.2500         0    0.2500         0
         0         0    0.2500    0.5000         0    0.2500         0
         0         0         0    0.2500    0.2500    0.2500    0.2500
         0    0.2500         0         0    0.2500    0.2500    0.2500
         0    0.2500         0         0         0    0.2500    0.2500
         0    0.2500         0         0         0         0    0.2500
         0    0.2500         0         0         0         0    0.2500

hW = inv(Id-C)*yW , HS = inv(Id-C)*YyL

hW =

    0.5433
    0.5457
    0.5574
    0.5550
    0.6440
    0.5152
    0.5152

{Undefined function or variable 'YyL'.
} 
hW = inv(Id-C)*yW , HS = inv(Id-C)*yL

hW =

    0.5433
    0.5457
    0.5574
    0.5550
    0.6440
    0.5152
    0.5152


HS =

    0.4567
    0.4543
    0.4426
    0.4450
    0.3560
    0.4848
    0.4848

save S_n_L
hS = HS

hS =

    0.4567
    0.4543
    0.4426
    0.4450
    0.3560
    0.4848
    0.4848

clear hS
hL = HS

hL =

    0.4567
    0.4543
    0.4426
    0.4450
    0.3560
    0.4848
    0.4848

h = [ hW hL ]

h =

    0.5433    0.4567
    0.5457    0.4543
    0.5574    0.4426
    0.5550    0.4450
    0.6440    0.3560
    0.5152    0.4848
    0.5152    0.4848

% Sanity check.
ones(1,2)*h
{Error using <a href="matlab:matlab.internal.language.introspective.errorDocCallback('mtimes')" style="font-weight:bold"> * </a>
Incorrect dimensions for matrix multiplication. Check that the number of columns in the first matrix
matches the number of rows in the second matrix. To perform elementwise multiplication, use '.*'.
} 
h*ones(2,1)

ans =

    1.0000
    1.0000
    1.0000
    1.0000
    1.0000
    1.0000
    1.0000

% OK, so it checks.
diary off
